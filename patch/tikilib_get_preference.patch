--- ../estudiolivre_base/lib/tikilib.php	2006-05-12 16:53:06.000000000 -0300
+++ lib/tikilib.php	2006-06-09 19:10:47.000000000 -0300
@@ -3231,7 +3231,7 @@
 
     function last_pages($maxRecords = -1) {
         global $user;
-	$query = "select `pageName`,`lastModif`,`user` from `tiki_pages` order by ".$this->convert_sortmode('lastModif_desc');
+	$query = "select `pageName`,`lastModif`,`user`,`comment` from `tiki_pages` order by ".$this->convert_sortmode('lastModif_desc');
 	$result = $this->query($query,array(),$maxRecords,0);
 	$ret = array();
 	while ($res = $result->fetchRow()) {
@@ -3528,12 +3528,13 @@
 	if (!isset($user_preferences[$user][$name])) {
 	    $query = "select `value` from `tiki_user_preferences` where `prefName`=? and `user`=?";
 
-	    $result = $this->getOne($query, array( "$name", "$user"));
+	    $result = $this->query($query, array($name, $user));
+		$row = $result->fetchRow();
 
-	    if (!$result) {
+	    if (!is_array($row)) {
 		$user_preferences[$user][$name] = $default;
 	    } else {
-		$user_preferences[$user][$name] = $result;
+		$user_preferences[$user][$name] = $row['value'];
 	    }
 	}
 
